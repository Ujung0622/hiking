<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper
      PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
   "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="admin.mapper.e_p001">
	<resultMap id="e_p001Result01" type="e_p001VO">
		<result property="userNum" column="userNum"  />
		<result property="id" column="id"  />
		<result property="password" column="password" />
		<result property="name" column="name" />
		<result property="sex" column="sex" /> <!--(남자 1 / 여자 2)  -->
		<result property="phone" column="phone" />
		<result property="address" column="address" />
		<result property="email" column="email" />
		<result property="type" column="type" /> <!-- 고객유형 (관리자 100 / 회원 200 / 비회원 300) -->
		<result property="createdAt" column="createdAt" /> <!-- 등록일자 -->
		<result property="updatedAt" column="updatedAt" /> <!--수정일자  -->
		<result property="status" column="status" /> <!--고객상태 (활동 10 / 휴면 20)  -->
		<result property="sexType" column="sexType" /> <!--성별 유형 담을 객체   -->
		<result property="usersType" column="usersType" /> <!--유저 타입 담을 객체  -->
		<result property="statusType" column="statusType" /> <!--유저 상태 담을 객체  -->
		
		<result property="createdAtString" column="createdAtString" /> <!--날짜 스트링 -->
		<result property="updatedAtString" column="updatedAtString" /> <!--날짜 스트링 -->
	</resultMap>
	
	<!-- 회원등록 -->
 	<insert id="insertUsers" parameterType="e_p001VO">
		<![CDATA[
		INSERT INTO USERS(userNum, id , password, name, sex, phone, address, email, type, createdAt, status)
		VALUES (USERS_SEQ.nextval, #{id}, #{password}, #{name}, #{sex}, #{phone}, #{address}, #{email}, #{type}, CURRENT_TIMESTAMP, 10)
		]]>
	</insert>  
	
	<!-- 회원 조건별 검색 -->
	<select id="selectUser" resultMap="e_p001Result01" parameterType="java.util.Map">
		 <![CDATA[
        select userNum, id,  password, name, 
        		DECODE(sex,10,'남자', 20, '여자')as sexType, 
       			phone, address, email, 
        		DECODE(type, 100, '관리자', 200, '회원', 300, '비회원')as usersType,  
        		to_char(createdAt,'YYYY-MM-DD HH24:MI:SS')as createdAtString,
        		to_char(updatedAt,'YYYY-MM-DD HH24:MI:SS')as updatedAtString, 
        		DECODE(status, 10, '활동', 20, '휴면')as statusType
		from   USERS
      	]]>
    	<choose>
    		<when test="searchOption=='userNum'">
    		<!-- where  userNum =userNum -->
    		</when>
    		<when test="searchOption!='userNum'">
    		where  ${searchOption} like '%'||#{key_word}||'%'
    		</when>
    	</choose>
	</select>
	
	<!-- 회원 삭제 -->
	<delete id="deleteUser"  parameterType="int">
	<![CDATA[
	   delete from  USERS
	   where
	   userNum=#{userNum}
	]]>      
  </delete>
  
  <!--수정전 회원정보 출력-->
  	<select id="selectUpdateUserList" resultMap="e_p001Result01" parameterType="java.util.Map">
		 <![CDATA[
        select userNum, id,  password, name, 
        		DECODE(sex,1,'남자', 2, '여자')as sexType, 
       			phone, address, email, 
        		DECODE(type, 100, '관리자', 200, '회원', 300, '비회원')as usersType,  
        		to_char(createdAt,'YYYY-MM-DD HH24:MI:SS')as createdAtString,
        		to_char(updatedAt,'YYYY-MM-DD HH24:MI:SS')as updatedAtString, 
        		DECODE(status, 10, '활동', 20, '휴면')as statusType
		from   USERS	
         where  userNum = #{userNum}
      	]]>
	</select>
	
	<!-- 회원정보 수정 -->
	 <update id="updateUser" parameterType="e_p001VO">
	  <![CDATA[
		UPDATE USERS
		SET name = #{name},
			sex = #{sex},
			phone = #{phone},
			address = #{address},
			email = #{email},
			type = #{type},
			status = #{status},
			updatedAt = CURRENT_TIMESTAMP
		WHERE id = #{id}
		 ]]>
	</update>
	
</mapper>